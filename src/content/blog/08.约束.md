---
title: 08.[SQL]约束
description: /
pubDate: 08 12 2025
categories:
  - tech
tags:
  - SQL
---
## 约束

| 约束类型 |  描述   |   关键字    | 举例 |
| :-----: | :--------: | :--------: | :--------: |
| 主键约束 | 主键是一行数据的唯一标识，要唯一且非空 | PRIMARY KEY |  ID、订单号 |
| 唯一约束 | 保证字段值的唯一性 | UNIQUE KEY | 电话号码、身份证号码 |
| 非空约束 | 保证字段值不能为空 | NOT NULL |  
| 默认约束 | 保证字段值有默认值 | DEFAULT |
| 检查约束 | 保证字段值的有效性 | CHECK |

约束作用于表中的字段，可以在创建、修改表的时候添加。

## 外键约束

外键约束：
- 主键和外键的关系：一个表只能有一个主键，可以有多个外键。
- 外键的作用：可以实现表与表之间的关系，实现数据完整性。


外键：![](https://blog-picbed-1317989631.cos.ap-hongkong.myqcloud.com/20251106200537.png)

### 建立外键关联

在两个表中建立外键关联，可以实现两个表之间的关系。

**注意**：添加联系之后，主表的主键必须存在，无法删除。

添加外键：

```sql
#建表时直接添加外键约束

CREATE TABLE 表名 (
    字段名 字段类型,
    ...
    [CONSTRAINT] [外键名] FOREIGN KEY (外键字段名) REFERENCES 主表名 (主表列名)
);

#在已有表中添加外键约束

ALTER TABLE 从表名 
ADD [CONSTRAINT] [fk_name]  #一般写为fk_从表名_主表名
FOREIGN KEY (从表中的外键字段)
REFERENCES 主表名 (主表的主键字段);

```
| 项                         | 含义                            |
| ------------------------- | ----------------------------- |
| **ALTER TABLE 表名**        | 修改指定表的结构（即要在哪个表中添加外键）         |
| **ADD CONSTRAINT 外键名**    | 给外键约束取一个名字（可选，但推荐命名，方便管理）     |
| **FOREIGN KEY (外键字段名)**   | 指定当前表中要作为外键的字段                |
| **REFERENCES 主表名 (主表列名)** | 指定外键所引用的主表和主表中的列（通常是主键或唯一约束列） |

### 删除外键关联

删除外键约束：

```sql
ALTER TABLE 表名 
DROP FOREIGN KEY fk_name;
```
### 删除、更新外键的行为配置

外键约束的行为配置：

```sql
ALTER TABLE 从表名 
ADD [CONSTRAINT] [fk_name]  #一般写为fk_从表名_主表名
FOREIGN KEY (从表中的外键字段)
REFERENCES 主表名 (主表的主键字段)
ON DELETE [关键字] ON UPDATE [关键字];
```

| 选项              | 主表删除时 / 更新时                                     | 从表的行为说明                      |
| --------------- | ----------------------------------------------- | ---------------------------- |
| **NO ACTION**   | 若主表记录被删除或更新，而从表仍有引用，则**阻止该操作**（与 `RESTRICT` 一样） | 保持数据一致性，不允许出现“悬空外键”          |
| **RESTRICT**    | 与 `NO ACTION` 基本相同，立即检查外键约束并阻止操作                | 一般数据库实现两者等价                  |
| **CASCADE**     | 当主表记录被删除或更新时，**从表同步删除或更新对应记录**                  | 级联操作，常用于一对多依赖关系              |
| **SET NULL**    | 当主表记录被删除或更新时，**从表外键字段置为 NULL**                  | 要求外键列允许 `NULL`               |
| **SET DEFAULT** | 当主表记录被删除或更新时，**从表外键字段恢复为默认值**                   | MySQL 通常不支持该选项，SQL Server 支持 |
