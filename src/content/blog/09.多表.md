---
title: 09.[SQL]多表查询
description: /
pubDate: 08 10 2025
categories:
  - tech
tags:
  - SQL
---
## 多表关系


### 一对多
处理：比如部门表中一个部门对应员工表中的多个员工，那么一为主表，多为从表，在从表中设置外键指向主表的主键。
### 多对多
处理：比如学生表和老师表之间存在多对多关系，那么需要建立第三张中间表，设置两个外键指向学生表和老师表的主键。
```bash
id | student_id | teacher_id
1  | 1          | 1
2  | 1          | 2
```
![](https://blog-picbed-1317989631.cos.ap-hongkong.myqcloud.com/20251106212038.png)

### 一对一
为确保一对一，可以设置从表的外键为唯一。
![](https://blog-picbed-1317989631.cos.ap-hongkong.myqcloud.com/20251106212402.png)

## 多表查询
`select * from 表1, 表2 where 表1.外键 = 表2.主键`

where条件消除了笛卡尔积的冗余部分，只返回符合条件的记录。

相当于是把两个表根据特定关系拼接起来，然后再进行where条件筛选(取交集)。属于隐式内连接。

![](https://blog-picbed-1317989631.cos.ap-hongkong.myqcloud.com/20251106213132.png)

### 内连接
取两表的交集，返回两表中所有匹配的记录。
```sql
select * from 表1 , 表2 where 表1.外键 = 表2.主键

select * from 表1 [inner] join 表2 on 表1.外键 = 表2.主键
```
### 左外连接、右外连接
保留左表，并把匹配的右表附上。

eg：员工表和部门表，有一个员工的部门id为null，此时用左外连接，则保留包括null的员工表，并把可用的部门信息附上。右外连接则相反。

取A，B表中所有匹配的记录，即使B表中没有匹配的记录。反之亦然。
```sql
select 表1.*, 表2.column_target from 表1 left [outer] join 表2 on 表1.外键 = 表2.主键

select 表1.*, 表2.column_target from 表1 right [outer] join 表2 on 表1.外键 = 表2.主键
```

### 自连接
查询表与自身的关系。

```sql
select * from 表1 t1 JOIN 表1 t2 ON 条件； #必须取别名，否则在on中的查询表名会冲突。
# 可以内连，左连，右连。
```
使用场景：
```sql
#在包含员工和领导的员工表中，查询某个员工的领导。

select a.name as 员工姓名, b.name as 领导姓名 
from 员工表 a join 员工表 b 
on a.领导id = b.id ;

#在包含员工和领导的员工表中，查询某个员工的领导，如果没有领导，也要显示出来。

select a.name as 员工姓名, b.name as 领导姓名 
from 员工表 a left join 员工表 b 
on a.领导id = b.id ;
```
### 联合查询
多个表的查询结果合并。
`union`：
```sql
select * from 表1 where 条件1
union [all]  
select * from 表2 where 条件2
# uinon 合并+去重
# union all 合并不去重
```
注意：union合并时，列名、数据类型必须一致，否则会报错。

### 嵌套查询（子查询）

#### 标量子查询 `where col <=  >= = ()`
查询单个值，返回单个值。相当于把where后的条件（标量）作为一个表达式来执行。
```sql
select 列名 from 表名 where 列名 = (select 列名 from 表名 where 条件)
```
#### 列子查询 `where col in \ not in \ any \ some \ all () `
查询一列值，返回一列值。

|操作符|含义|
|------|----|
|in|在某一列表中|
|not in|不在某一列表中|
|any|至少有一个满足条件的元素 |
|some|  any 和 some 等同|
|all|所有元素都满足条件|

以查工资为例：
- in,not in 要求工资在（）内或不在。
- all 要求工资要大于（）内的所有值
- any\some 要求工资大于（）内的任意一个值。
#### 行子查询 `where =  \ != \  in \ not in  ()`
查询一行记录，返回一行记录。
和列子查询类似，但返回的是一行记录。按照逻辑自己写即可。

#### 表子查询 `where (a,b,c) in (step1表)` `from (step1表) left join `
主要用in，因为对象时子表。
```sql
# 查询和佳佳，小智的职位和工资相同的员工
# 佳佳： 会计    10000
# 小智： 程序员  5000

# step1: #
select 职位，工资 from 员工表 where 姓名 in ('佳佳', '小智') 
#这是一个2*2的表

# step2: #
select * from 员工表 where (职位，工资) in (step1) 
#(职位，工资) in step1的2*2的表 
```

```sql
# 查入职日期在date之后的员工信息，和部门信息，部门信息在另一张表中。

# step1: #
select * from 员工表 where 入职日期 > '2020-01-01'

# step2: #
select *
from (step1)
left join 部门表 on 员工表.部门id = 部门表.id
```